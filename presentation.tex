% Preamble
\documentclass[handout]{beamer}
\usepackage[utf8]{inputenc}
\usepackage{german}
\usepackage{ngerman}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{eurosym}
\usepackage{amsmath}
\usepackage{lipsum}

\title[TSP]
{Travelling Salesman Problem}
\subtitle{Exakte Lösungen}
\author
{Axel Christ}
\institute{DHBW Karlsruhe}
\subject{Theorieseminar Informatik}

\newcommand{\centeredimage}[2]{
  \begin{figure}
    \centering
    \includegraphics[width=\linewidth,height=150px,keepaspectratio]{#1}
    \caption{#2}
  \end{figure}
}

\newcommand{\imageslide}[2]{
  \begin{frame}
    \centeredimage{#1}{#2}
  \end{frame}
}

\newcommand{\fullscreenimage}[1]{
  { % all template changes are local to this group.
    \setbeamertemplate{navigation symbols}{}
    \begin{frame}[plain]
        \begin{tikzpicture}[remember picture,overlay]
            \node[at=(current page.center)] {
                \includegraphics[width=\paperwidth,height=\paperheight,keepaspectratio]{#1}
            };
        \end{tikzpicture}
     \end{frame}
  }
}

\newcommand{\sloganslide}[2]{
  \begin{frame}
    \begin{center}
      \Huge #1
      \ifx&#2&%
        \huge #2
      \fi
    \end{center}
  \end{frame}
}

\AtBeginSection[]
{
  \begin{frame}
    \frametitle{Table of Contents}
    \tableofcontents[currentsection]
  \end{frame}
}

\begin{document}
  \fullscreenimage{buyonline.jpeg} % Wir kaufen einen neuen Laptop online

  \fullscreenimage{postbote.jpg} % Versand natürlich mit der Post, aber

  \sloganslide{Wie sieht eigentlich die Tour des Postboten aus?}

  \fullscreenimage{deutschland.png} % Planung einer Tour zu den Kunden

  \imageslide{deutschland_solved.jpg}{Gelöst 2001: 15,112 Städte in Deutschland}

  \imageslide{schweden_solved.jpg}{Gelöst 2004: 24,978 Städte in Schweden}

  \sloganslide{Und doch NP-Vollständig?}

  \frame{\titlepage}

  \section{Definition}
  \begin{frame}
    \frametitle{Definition}
    \begin{center}
      Ein Handlungsreisender muss mehrere Städte besuchen. Dabei soll die
      Strecke, um alle Städte zu besuchen, möglichst kurz sein.
    \end{center}
  \end{frame}

  \begin{frame}
    \frametitle{Definition}
    Es gibt $N$ Städte.
    \pause
    \\~\\

    Zwischen zwei Städten $i$ und $j$ gibt es jeweils eine Kante $c_{ij}$.
    Sollte einmal keine Kante bestehen, so wird eine Kante mit großer Länge
    automatisch eingefügt. Repräsentiert wird das Problem als ein Graph.
    \pause
    \\~\\

    Zu jeder Kante (Verbindung zwischen zwei Städten) gibt es eine Länge $c_{i,j} \geq 0$
    \pause
    \\~\\

    Gesucht ist ein Hamiltonkreis, der jeden Knoten (jede Stadt) genau einmal enthält.
    Dabei soll der Umfang des Hamiltonkreises minimiert werden, eine möglichst kurze Tour
    soll gefunden werden.
  \end{frame}

  \begin{frame}
    \frametitle{TSP-Klassifikationen}
    \begin{itemize}[<+->]
      \item \textbf{Symmetrisches TSP}
        \linebreak
        Ungerichteter Graph
        $$c_{ij} = c_{ji}$$
        Hin- und Rückweg zwischen zwei Knotenpunkten stets gleich
      \item \textbf{Asymmetrisches TSP}
        \linebreak
        Gerichteter Graph
        Hin- und Rückweg zwischen zwei Knotenpunkten muss nicht gleich sein
      \item \textbf{Metrisches TSP}
        \linebreak
        Erfüllen der Dreiecksungleichung
        $$c_{ij} \le c_{ik} + c_{kj}$$
        Verbindung von $i$ nach $j$ nie länger als über dritten Knoten $k$
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Nicht-metrisches TSP}
    Ein TSP-Problem kann auch nicht-metrisch sein, wenn Umrüstzeiten
    berücksichtigt werden müssen.
    \pause
    \linebreak
    Beispiel: Drei Trucks sollen an verschiedenen Stationen Gegenstände
    abliefern und aufnehmen:
    \begin{figure}
      \centering
      \includegraphics[width=\linewidth,height=150px,keepaspectratio]{truck_problem.png}
      \caption{Truck Problem}
    \end{figure}
  \end{frame}

  \section{Komplexität}
  \begin{frame}
    \frametitle{Komplexitätsbetrachtung}
    Bei einem symmetrischen TSP gibt es $\frac{(n-1)!}{2}$ mögliche Routen,
    bei einem asymmetrischen $(n-1)!$ mögliche!

    \newcount\mycount

    \begin{figure}
      \centering
      \begin{tikzpicture}[transform shape,scale=0.4]
        %the multiplication with floats is not possible. Thus I split the loop in two.
        \foreach \number in {1,...,8}{
            % Computer angle:
              \mycount=\number
              \advance\mycount by -1
        \multiply\mycount by 45
              \advance\mycount by 0
            \node[draw,circle,inner sep=0.25cm] (N-\number) at (\the\mycount:5.4cm) {};
          }
        \foreach \number in {9,...,16}{
            % Computer angle:
              \mycount=\number
              \advance\mycount by -1
        \multiply\mycount by 45
              \advance\mycount by 22.5
            \node[draw,circle,inner sep=0.25cm] (N-\number) at (\the\mycount:5.4cm) {};
          }
        \foreach \number in {1,...,15}{
              \mycount=\number
              \advance\mycount by 1
        \foreach \numbera in {\the\mycount,...,16}{
          \path (N-\number) edge[->,bend right=3] (N-\numbera)  edge[<-,bend
            left=3] (N-\numbera);
        }
      }
      \end{tikzpicture}
      \caption{Anzahl mögliche Verbindungen bei $n=16$}
    \end{figure}
  \end{frame}

  \begin{frame}
    \frametitle{Verbindungen}

    Woher bekommt man die Informationen über Verbindungslängen?
    \pause
    \vspace{2em}

    Dijkstra-Algorithmus für alle Städte explodiert!

    \pause
    \vspace{1em}

    \textbf{Beispiel}: Bei 1000 Städten: \\~\\
    $1000 \cdot 1000 = 1 000 000$ mögliche Verbindungen!
    $\rightarrow 1 000 000$ Dijkstra-Läufe

    \vspace{1em}
    Laufzeit Dijkstra: $\mathcal O(n \cdot \log n + m)$ \textit{(optimiert)}
    \\~\\
    $n$ Anzahl der Knoten, $m$ Anzahl der Kanten
  \end{frame}

  \section{Mathematische Betrachtung}

  \begin{frame}
    \frametitle{Mathematische Betrachtung}
    \begin{itemize}
      \item Knotenmenge $V$
      \item Pro Kante ein Bit $x$:
      \begin{itemize}
        \item $x=1 \rightarrow$ Kante ist in Tour enthalten
        \item $x=0 \rightarrow$ Kante ist nicht in Tour enthalten 
      \end{itemize}
    \end{itemize}
    \textbf{Aufgabe ist:}
    $$min\sum_{i \in V} \sum_{j \in V \backslash i} c_{i,j}x_{i,j}$$
  \end{frame}

  \sloganslide{Ist jede somit definierte Tour valide?}

  \fullscreenimage{nodes.png}

  \fullscreenimage{invalid_tour.png}

  \begin{frame}
    \frametitle{Randbedingungen}
    \begin{Large}
      \begin{center}
        Jeder Knoten muss exakt 2 Verbindungen haben!
      \end{center}

      \pause
      \textbf{Deshalb:}
      $$\sum_{j \in V \backslash i}x_{i,j} = 2$$
    \end{Large}
  \end{frame}

  \sloganslide{Sind somit alle Touren valide?}

  \fullscreenimage{kurzkreiszyklen.png}

  \begin{frame}
    \frametitle{Randbedingungen}
    \begin{Large}
      \begin{center}
        Alle Knoten sollen in einer Tour miteinander verbunden sein,
        keine \textit{Kurzkreiszyklen} sollen entstehen!
      \end{center}

      \pause
      \textbf{Deshalb:}
      $$\sum_{i \in S, j \notin S}x_{i,j} \geq 2$$
    \end{Large}
  \end{frame}

  \begin{frame}
    \frametitle{Mathematische Betrachtung}
    \begin{itemize}
      \item Knotenmenge $V$
      \item Pro Kante ein Bit $x$:
      \begin{itemize}
        \item $x=1 \rightarrow$ Kante ist in Tour enthalten
        \item $x=0 \rightarrow$ Kante ist nicht in Tour enthalten 
      \end{itemize}
      \item
        Pro Knoten (Stadt) genau zwei Kanten
        $$\sum_{j \in V \backslash i}x_{i,j} = 2$$
      \item
        Keine Kurzkreiszyklen
        $$\sum_{i \in S, j \notin S}x_{i,j} \geq 2$$
    \end{itemize}
    \pause
    \textbf{Aufgabe ist:}
    $$min\sum_{i \in V} \sum_{j \in V \backslash i} c_{i,j}x_{i,j}$$
  \end{frame}

  \section{Exakte Lösungen}

  \begin{frame}
    \frametitle{Lösung durch Permutation}

    \begin{enumerate}[<+->]
      \item Permutation durch alle möglichen Touren
      \item Für kleine $n$ noch machbar
      \item Jedoch: $n$ steigt schnell drastisch an (Fakultät)
    \end{enumerate}

    \pause

    \begin{figure}
      \centering
      \begin{tikzpicture}[scale=0.6]
        \begin{axis}[
            symbolic x coords={3, 4, 5, 6, 7, 8},
            xtick=data
          ]
            \addplot[ybar,fill=blue] coordinates {
                (3, 1)
                (4, 3)
                (5, 12)
                (6, 60)
                (7, 360)
                (8, 2520)
            };
        \end{axis}
      \end{tikzpicture}
      \caption{Anzahl Touren in Abhängigkeit $n$ bei symmetrischem TSP}
    \end{figure}
  \end{frame}

  \subsection{Lineare Programmierung}
  \begin{frame}
    \frametitle{Problemstellung}

    Eine Möbelfirma produziert zwei Arten von Sofas: Ein Standard-
    und ein Sondermodell.
    \pause
    \\~\\

    Die Produktion eines Standardmodells benötigt zwei Stunden, die
    eines Sondermodells drei.
    \pause
    \\~\\

    Drei Arbeiter arbeiten jew. 8 Stunden am Tag
    \pause
    \\~\\

    Der maximale tägliche Bedarf an Standardsofas ist 6, bei
    Sondersofas 8.
    \pause
    \\~\\

    Ein Standardsofa bringt 500\euro, ein Sondermodell 300\euro.
    \pause
    \\~\\

    \textbf{Wie kann der Profit der Möbelfirma maximiert werden?}
  \end{frame}

  \begin{frame}
    \frametitle{Datenanalyse}

    \textbf{Was sind die Entscheidungsvariablen?}
    \linebreak
    \pause
    Anzahl der Standardsofas ($x$) und Anzahl der Sondersofas ($y$) die pro
    Tag produziert werden sollen.
    \pause
    \\~\\

    \textbf{Was sind die Randbedingungen?}
    \pause
    \begin{itemize}[<+->]
      \item Verfügbare Arbeitskapazität pro Tag: $3 \cdot 8 = 24$
      \item Maximale Nachfrage pro Tag
        \begin{itemize}
          \item Standardsofas: 6
          \item Sondersofas: 8 
        \end{itemize}
      \item Zeitverbrauch pro Einheit
        \begin{itemize}
          \item Standardsofa: 2h
          \item Sondersofa: 3h 
        \end{itemize}
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Mathematische Repräsentation}

    \textbf{Zielfunktion}
    $$f(x) = 500x \cdot 300y $$
    \pause

    \textbf{Nachfrage}
    $$x \leq 6$$
    $$y \leq 8$$
    \pause

    \textbf{Max. Arbeitskapazität}
    $$2x + 3y \leq 24$$
    \pause

    \textbf{Entscheidungsvariablen müssen nichtnegativ sein}
    $$x, y \geq 0$$
  \end{frame}

  \begin{frame}
    \frametitle{Graphische Repräsentation}
    \begin{columns}[onlytextwidth]
      \begin{column}{0.4\textwidth}
        \begin{itemize}[<+->]
          \item Anfänglich: Alle Werte möglich
          \item Dann: Beschränken durch Constraints
          \item Zusätzlich: Anzeige der Fitnessfunktion
        \end{itemize}
      \end{column}
      \begin{column}{0.6\textwidth}
        \begin{figure}
          \centering
          \includegraphics[width=\linewidth,height=150px,keepaspectratio]{optimization_graphic.png}
        \end{figure}
      \end{column}
    \end{columns}
  \end{frame}

  \begin{frame}
    \frametitle{Problem der Lösung}
    \begin{columns}[onlytextwidth]
      \begin{column}{0.4\textwidth}
        \begin{itemize}[<+->]
          \item Lösung liegt immer in den Eckbereichen der zulässigen Lösungen
          \item Lösung liegt oft im kontinuierlichen
          \item \textbf{Jedoch:} Für Sofaproblem sollten nur ganzzahlige Lösungen akzeptiert werden!
        \end{itemize}

        \textbf{$\rightarrow$ Andere Lösungsmethoden benötigt!}
      \end{column}
      \begin{column}{0.6\textwidth}
        \begin{figure}
          \centering
          \includegraphics[width=\linewidth,height=150px,keepaspectratio]{mlp_solutions.png}
        \end{figure}
      \end{column}
    \end{columns}
  \end{frame}

  \subsubsection{Branch and Bound}
  \begin{frame}
    \frametitle{Branch and Bound}

    Lösungsmethode von Ganzzahligen Problemen
    \begin{enumerate}[<+->]
      \item Lineare Relaxierung des Problems
      \item Verzweigen
      \item Begrenzen
      \item Optimalitätstest
    \end{enumerate}
  \end{frame}

  \begin{frame}
    \frametitle{Branch and Bound}
    \textbf{Beispiel}
    $$z = x + 4 * y$$

    Constraints:
    \begin{itemize}
      \item $5x + 8y \leq 40$
      \item $-2x + 3y \leq 9$
      \item $x, y \geq 0$ 
    \end{itemize}

    \pause
    \vspace{1em}

    \textit{Lösung ohne ganzzahlige Beschränkung}
    $$x = 1\frac{17}{31}, y = 4\frac{1}{31}, z = 17\frac{21}{31}$$
  \end{frame}

  \begin{frame}
    \frametitle{Grafische Visualisierung}
    \begin{figure}
      \centering
      \includegraphics[width=\linewidth,height=150px,keepaspectratio]{example_graphical_representation.png}
      \caption{Mögliche Lösungen und Constraints des Problems}
    \end{figure}
  \end{frame}

  \begin{frame}
    \frametitle{Grafische Visualisierung}
    \begin{figure}
      \centering
      \includegraphics[width=\linewidth,height=150px,keepaspectratio]{example_noninteger_solution.png}
      \caption{Lösung nach linearer Relaxierung}
    \end{figure}
    $$x = 1\frac{17}{31}, y = 4\frac{1}{31}, z = 17\frac{21}{31}$$
  \end{frame}

  \foreach \x in {1,2,3,4,5,6,7,8,9,10,11,12}
  {
    \imageslide{branch_and_bound\x.png}{Branch and Bound \x}
  }

  \subsubsection{Cutting Planes}
  \begin{frame}
    \frametitle{Cutting Planes}

    \begin{itemize}
      \item Andere Methode der Linearen Programmierung
      \item Startpunkt ebenfalls relaxierte Lösung
      \item Unterschied: Schnittebenen, um Lösungsraum einzuschränken
      \item Schnittebenen sind im Allgemeinen weitere Constraint-Ungleichungen
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Anforderungen an Schnittebenen}

    \begin{itemize}
      \item Keine mögliche Lösung darf abgeschnitten werden
      \item Die letzte, nichtganzzahlige Lösung soll abgeschnitten werden 
    \end{itemize}

    \pause
    \textbf{Jedoch:} Pure Verwendung des Schnittebenenverfahrens sehr langsam
    \pause
    \\~\\

    $\rightarrow$ \textbf{Deshalb:} Kombination beider Ansätze zu \textit{Branch and Cut}
  \end{frame}

  \begin{frame}
    \frametitle{Vorgehensweise}

    Ähnlich wie bei Branch and Bound, jedoch wird vor Verzweigung
    versucht, mit Schnittebenen den Lösungsraum einzugrenzen.

    \pause
    \vspace{1em}

    Nach Eingrenzung durch Schnittebenen: \\~\\
    \textit{Ist Lösung ganzzahlig?}

    \pause
    \vspace{1em}

    \textbf{Falls ja:} Lösung optimal, Abbruch
    \pause
    \textbf{Falls nein:} Aufsplitten wie bei Branch and Bound, rekursive Anwendung
  \end{frame}

  \begin{frame}
    \frametitle{Programme in der Praxis}
    Anwendung in der Praxis mit Programm \textit{Concorde}
  \end{frame}

\end{document}